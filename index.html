<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Time Weaver</title>
    <style>
        body {
            font-family: 'Trebuchet MS', sans-serif;
            background: radial-gradient(circle, #1e1e2f, #343456);
            color: #ffffff;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        h1 {
            margin-top: 20px;
            font-size: 3rem;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
        }

        #threadButton {
            margin: 20px auto;
            padding: 20px 40px;
            font-size: 1.5rem;
            background: linear-gradient(90deg, #6c63ff, #867dfc);
            border: none;
            border-radius: 15px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 8px #4941d6;
            transition: all 0.3s ease;
        }

        #threadButton:active {
            box-shadow: 0 4px #4941d6;
            transform: translateY(4px);
        }

        #threadButton:hover {
            background: linear-gradient(90deg, #867dfc, #6c63ff);
        }

        #resources {
            margin: 20px 0;
            font-size: 1.2rem;
        }

        .upgrade {
            margin: 15px;
            padding: 15px 30px;
            font-size: 1.1rem;
            background: linear-gradient(90deg, #4caf50, #81c784);
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
            box-shadow: 0 6px #388e3c;
            transition: all 0.3s ease;
        }

        .upgrade:disabled {
            background: #777;
            cursor: not-allowed;
            box-shadow: none;
        }

        .upgrade:hover:not(:disabled) {
            background: linear-gradient(90deg, #81c784, #4caf50);
        }

        .upgrade:active:not(:disabled) {
            box-shadow: 0 3px #388e3c;
            transform: translateY(3px);
        }

        #timeline {
            margin: 20px auto;
            padding: 20px;
            background: #2c2f3a;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            color: #ddd;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.5);
            text-align: left;
        }

        #timeline h2 {
            margin: 0 0 20px;
            font-size: 2rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.6);
        }

        .event {
            margin: 10px 0;
            padding: 10px;
            background: linear-gradient(90deg, #607d8b, #78909c);
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            color: #fff;
            font-size: 1rem;
        }

        .visual-feedback {
            position: absolute;
            pointer-events: none;
            font-size: 1rem;
            color: #ffd700;
            animation: fadeOut 1s ease forwards;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-30px);
            }
        }
    </style>
</head>
<body>
    <h1>Time Weaver</h1>

    <div id="resources">
        <p><strong>Threads:</strong> <span id="threadCount">0</span></p>
        <p><strong>Threads / second:</strong> <span id="threadsPerSecond">0</span></p>
    </div>

    <button id="threadButton">Weave Time Thread</button>

    <div id="upgrades">
        <button class="upgrade" id="loomSpinnerUpgrade" disabled>Buy Loom Spinner (50 threads)</button>
        <!-- Speed Upgrade button -->
        <button class="upgrade" id="speedUpgrade" disabled></button>
        <!-- Efficiency Upgrade button -->
        <button class="upgrade" id="efficiencyUpgrade" disabled></button>
    </div>

    <div id="timeline">
        <h2>Timeline</h2>
        <button class="upgrade" id="createEvent" disabled>Weave Event (100 threads)</button>
        <div id="events">
            <!-- Timeline events will appear here -->
        </div>
    </div>

    <script>
        // Core resources
        let threads = 0;

        // Loom Spinner data
        let loomSpinners = 0;
        let loomSpinnerCost = 50;

        // Speed Upgrade
        // Each level doubles Loom Spinner production: 1→2→4→8...
        // The cost array can expand beyond the first few values if needed.
        let speedLevel = 0;
        const speedCosts = [50, 150, 300, 600, 1200];

        /*
            Speed Upgrades
            Core Idea:
            Each upgrade doubles the production rate of the Loom Spinner (1 → 2 → 4 → 8 threads/sec, etc.).
            The cost of each Speed Upgrade also scales up progressively (e.g., 50 → 150 → 300 threads, etc.).

            Why It Works:
            This offers exponential growth potential, making it a compelling upgrade path.
        */

        // Efficiency Upgrade
        // - Cost Reduction: each level reduces future purchase costs by a small %
        // - Production Boost: each level grants +10% multiplicative production bonus
        let efficiencyLevel = 0;
        const efficiencyCosts = [100, 200, 400, 800];

        /*
            Efficiency Upgrades
            Core Idea:
            Cost Reduction: Each Efficiency Upgrade reduces the cost of future purchases by a small percentage (e.g., -2% or -5% per rank).
            Production Boost: Each Efficiency Upgrade also grants a smaller multiplicative boost to production (e.g., +10% per rank, stacking).
        */

        // For simplicity, let's define:
        // - 5% cost reduction per rank (applied to Loom Spinner + Speed Upgrade costs)
        // - +10% production for Loom Spinners, stacked multiplicatively with Speed Upgrades
        // You can tweak these values as you see fit.

        function getCostDiscountFactor() {
            // 5% discount per level
            // e.g., level=1 => 0.95, level=2 => 0.90, etc.
            const discount = 0.05 * efficiencyLevel;
            // avoid going below 50% or negative discount
            return Math.max(1 - discount, 0.5);
        }

        function getProductionMultiplier() {
            // +10% per rank
            return 1 + 0.1 * efficiencyLevel;
        }

        // Functions to get next Speed/Efficiency costs
        function getSpeedUpgradeBaseCost() {
            if (speedLevel < speedCosts.length) {
                return speedCosts[speedLevel];
            } else {
                // If beyond the initial array, just double the last known cost each time.
                let lastCost = speedCosts[speedCosts.length - 1];
                return lastCost * 2 ** (speedLevel - speedCosts.length + 1);
            }
        }

        function getSpeedUpgradeCost() {
            // apply cost discount factor
            return Math.floor(getSpeedUpgradeBaseCost() * getCostDiscountFactor());
        }

        function getEfficiencyUpgradeBaseCost() {
            if (efficiencyLevel < efficiencyCosts.length) {
                return efficiencyCosts[efficiencyLevel];
            } else {
                // double the last known cost each time
                let lastCost = efficiencyCosts[efficiencyCosts.length - 1];
                return lastCost * 2 ** (efficiencyLevel - efficiencyCosts.length + 1);
            }
        }

        function getEfficiencyUpgradeCost() {
            // Efficiency upgrade cost is not discounted by itself in this example
            return getEfficiencyUpgradeBaseCost();
        }

        function getLoomSpinnerCost() {
            // apply discount factor
            return Math.floor(loomSpinnerCost * getCostDiscountFactor());
        }

        // main TPS calculation
        function getThreadsPerSecond() {
            // base production for each Loom Spinner is 1
            // speedLevel doubles that => 2^speedLevel
            // efficiencyLevel adds +10% each => multiply by getProductionMultiplier()
            const spinnerRate = Math.pow(2, speedLevel) * getProductionMultiplier();
            return Math.floor(loomSpinners * spinnerRate);
        }

        // cost for weaving an event
        let eventCost = 100;

        // update UI
        function updateUI() {
            document.getElementById('threadCount').textContent = threads;
            document.getElementById('threadsPerSecond').textContent = getThreadsPerSecond();

            // Loom Spinner button
            const spinnerCost = getLoomSpinnerCost();
            const spinnerBtn = document.getElementById('loomSpinnerUpgrade');
            spinnerBtn.textContent = `Buy Loom Spinner (${spinnerCost} threads)`;
            spinnerBtn.disabled = threads < spinnerCost;

            // Speed Upgrade button
            const speedCost = getSpeedUpgradeCost();
            const speedBtn = document.getElementById('speedUpgrade');
            speedBtn.textContent = `Speed Upgrade (Cost: ${speedCost}, Level: ${speedLevel})`;
            speedBtn.disabled = threads < speedCost;

            // Efficiency Upgrade button
            const effCost = getEfficiencyUpgradeCost();
            const effBtn = document.getElementById('efficiencyUpgrade');
            effBtn.textContent = `Efficiency Upgrade (Cost: ${effCost}, Level: ${efficiencyLevel})`;
            effBtn.disabled = threads < effCost;

            // Event creation button
            document.getElementById('createEvent').disabled = threads < eventCost;
        }

        // visual feedback
        function showVisualFeedback(text, x, y) {
            const feedback = document.createElement('div');
            feedback.classList.add('visual-feedback');
            feedback.style.left = `${x}px`;
            feedback.style.top = `${y}px`;
            feedback.textContent = text;
            document.body.appendChild(feedback);

            setTimeout(() => {
                feedback.remove();
            }, 1000);
        }

        // thread button
        document.getElementById('threadButton').addEventListener('click', (e) => {
            threads++;
            updateUI();

            const rect = e.target.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top;
            showVisualFeedback('+1', x, y);
        });

        // buy Loom Spinner
        document.getElementById('loomSpinnerUpgrade').addEventListener('click', () => {
            const cost = getLoomSpinnerCost();
            if (threads >= cost) {
                threads -= cost;
                loomSpinners++;
                // base cost grows each time, no discount on growth factor
                loomSpinnerCost = Math.floor(loomSpinnerCost * 1.5);
                updateUI();
            }
        });

        // buy Speed Upgrade
        document.getElementById('speedUpgrade').addEventListener('click', () => {
            const cost = getSpeedUpgradeCost();
            if (threads >= cost) {
                threads -= cost;
                speedLevel++;
                updateUI();
            }
        });

        // buy Efficiency Upgrade
        document.getElementById('efficiencyUpgrade').addEventListener('click', () => {
            const cost = getEfficiencyUpgradeCost();
            if (threads >= cost) {
                threads -= cost;
                efficiencyLevel++;
                updateUI();
            }
        });

        // thread production automation
        setInterval(() => {
            const tps = getThreadsPerSecond();
            if (tps > 0) {
                threads += tps;
                updateUI();
                const button = document.getElementById('threadButton');
                const rect = button.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top;
                showVisualFeedback(`+${tps}`, x, y);
            }
        }, 1000);

        // create timeline event
        document.getElementById('createEvent').addEventListener('click', () => {
            if (threads >= eventCost) {
                threads -= eventCost;
                const eventDiv = document.createElement('div');
                eventDiv.classList.add('event');
                eventDiv.textContent = `Event ${document.querySelectorAll('.event').length + 1}: A moment in time.`;
                document.getElementById('events').appendChild(eventDiv);
                updateUI();
            }
        });

        // init
        updateUI();
    </script>
</body>
</html>
